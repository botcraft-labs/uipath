<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bot Craft Resume Studio - Pro</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Playfair+Display:wght@700&family=Montserrat:wght@700&family=Fira+Code:wght@400;700&family=Poppins:wght@400;700&family=Lora:wght@400;700&family=Open+Sans:wght@400;700&display=swap');
    :root { 
        --glass: rgba(255, 255, 255, 0.05); 
        --border: rgba(255, 255, 255, 0.15); 
        --accent: #38bdf8; 
        --neon: 0 0 15px rgba(56, 189, 248, 0.6);
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
    }
    
    * { box-sizing: border-box; }
    
    body { 
        font-family: 'Inter', sans-serif; 
        background: radial-gradient(circle at top right, #1e293b, #020617); 
        min-height: 100vh; 
        color: #f8fafc; 
        padding-top: 80px;
        overflow-x: hidden;
    }
    
    .glass-panel { 
        background: var(--glass); 
        backdrop-filter: blur(25px); 
        -webkit-backdrop-filter: blur(25px);
        border: 1px solid var(--border); 
        border-radius: 24px; 
        padding: 25px; 
        box-shadow: 0 15px 45px rgba(0,0,0,0.4);
        animation: fadeIn 0.4s ease-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .glass-btn { 
        background: rgba(255, 255, 255, 0.05); 
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1); 
        color: white; 
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        font-weight: 600; 
        border-radius: 12px; 
        font-size: 0.8rem;
        padding: 8px 16px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .glass-btn:hover { 
        border-color: var(--accent); 
        box-shadow: var(--neon); 
        transform: translateY(-2px); 
        color: var(--accent); 
        background: rgba(255, 255, 255, 0.1); 
    }
    
    .glass-btn-primary {
        background: var(--accent);
        color: #000;
        font-weight: 700;
        border: 1px solid var(--accent);
        box-shadow: 0 0 15px rgba(56, 189, 248, 0.4);
    }
    
    .glass-btn-primary:hover {
        background: #7dd3fc;
        color: #000;
        box-shadow: 0 0 25px rgba(56, 189, 248, 0.6);
    }
    
    .glass-select { 
        background: rgba(0,0,0,0.4) !important; 
        border: 1.5px solid var(--accent) !important; 
        color: white !important; 
        cursor: pointer; 
        border-radius: 10px; 
        padding: 8px 35px 8px 12px; 
        appearance: none; 
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") !important; 
        background-repeat: no-repeat !important; 
        background-position: right 12px center !important;
        transition: all 0.3s;
    }
    
    .glass-select:hover {
        border-color: #7dd3fc !important;
        box-shadow: var(--neon);
    }
    
    .glass-select option { 
        background: #111827; 
        color: white; 
    }

    .form-control, .rich-editor { 
        background: rgba(0,0,0,0.3) !important; 
        border: 1.5px solid var(--border) !important; 
        color: white !important; 
        transition: all 0.3s; 
        border-radius: 12px;
        padding: 10px 14px;
        backdrop-filter: blur(5px);
    }
    
    .form-control::placeholder { 
        color: rgba(255, 255, 255, 0.5) !important; 
        opacity: 1; 
    }
    
    .rich-editor:empty:before { 
        content: attr(data-placeholder); 
        color: rgba(255, 255, 255, 0.5); 
        font-style: italic; 
    }
    
    .form-control:focus, .rich-editor:focus { 
        box-shadow: var(--neon) !important; 
        outline: none; 
        background: rgba(0,0,0,0.4) !important;
        border-color: var(--accent) !important;
    }

    .resume-preview { 
        background: white; 
        color: #1e293b; 
        border-radius: 4px; 
        min-height: 1123px; 
        padding: 50px; 
        box-shadow: 0 30px 80px rgba(0,0,0,0.6); 
        position: relative; 
        transition: 0.4s; 
        overflow: hidden;
        margin: 0 auto;
        max-width: 794px;
    }
    
    /* Updated Print Styles for Better Splitting */
    .sec-item {
        break-inside: avoid;
        page-break-inside: avoid;
    }

    .page-break-guide { 
        position: absolute; 
        left: 0; 
        right: 0; 
        height: 1px; 
        border-top: 2px dashed #ff4757; 
        opacity: 0.3; 
        pointer-events: none;
        z-index: 100;
    }
    
    .page-break-guide::after { 
        content: "‚úÇ PAGE BOUNDARY"; 
        position: absolute; 
        right: 20px; 
        top: -12px; 
        font-size: 8px; 
        font-weight: 800; 
        background: #ff4757; 
        color: white; 
        padding: 2px 6px; 
        border-radius: 4px; 
    }
    
    .section-header { 
        border-bottom: 2px solid #334155; 
        margin: 15px 0 10px; 
        font-weight: 800; 
        text-transform: uppercase; 
        letter-spacing: 1px;
        font-size: 0.95rem;
    }
    
    .rich-editor { 
        min-height: 60px; 
        padding: 12px; 
        border-radius: 8px; 
        font-size: 0.85rem; 
        background: white !important; 
        color: black !important;
        overflow-y: auto;
        max-height: 200px;
    }
    
    .config-panel .rich-editor { 
        background: rgba(0,0,0,0.3) !important; 
        color: white !important; 
    }
    
    .toolbar { 
        display: flex; 
        gap: 4px; 
        margin-bottom: 8px;
        flex-wrap: wrap;
    }
    
    .toolbar button { 
        background: rgba(255,255,255,0.05); 
        border: 1px solid var(--border); 
        color: white; 
        border-radius: 8px; 
        width: 32px; 
        height: 32px; 
        font-size: 0.75rem; 
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        backdrop-filter: blur(4px);
    }
    
    .toolbar button:hover { 
        background: var(--accent); 
        color: black; 
        border-color: var(--accent);
        transform: scale(1.1);
        box-shadow: var(--neon);
    }
    
    .entry-card { 
        background: rgba(255,255,255,0.03); 
        border: 1px solid var(--border); 
        padding: 0;
        border-radius: 20px; 
        margin-bottom: 15px; 
        position: relative;
        transition: all 0.3s;
        backdrop-filter: blur(5px);
        overflow: hidden;
    }
    
    .entry-card:hover {
        border-color: var(--accent);
        background: rgba(255,255,255,0.05);
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    /* New Minimize Feature Styles */
    .entry-header {
        background: rgba(255,255,255,0.05);
        padding: 10px 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--border);
    }
    
    .card-title-preview {
        font-size: 0.85rem;
        font-weight: 700;
        color: var(--accent);
        margin: 0;
    }

    .entry-body {
        padding: 18px;
        transition: all 0.3s ease;
    }

    .entry-card.collapsed .entry-body {
        display: none;
    }

    .entry-card.collapsed {
        background: rgba(0,0,0,0.4);
    }
    
    label { 
        font-size: 0.65rem; 
        color: #cbd5e1; 
        font-weight: 800; 
        text-transform: uppercase; 
        margin-bottom: 8px; 
        display: inline-block; 
        letter-spacing: 0.5px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
        padding: 5px 12px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: all 0.3s;
    }

    label:hover {
        border-color: var(--accent);
        color: white;
        background: rgba(255, 255, 255, 0.1);
    }
    
    .gallery-overlay { 
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(2, 6, 23, 0.98); 
        z-index: 5000; 
        display: none; 
        padding: 40px; 
        overflow-y: auto; 
        backdrop-filter: blur(30px);
        animation: fadeIn 0.3s ease-out;
    }
    
    .template-card { 
        background: rgba(255, 255, 255, 0.03); 
        border: 1px solid var(--border); 
        border-radius: 22px; 
        padding: 20px; 
        cursor: pointer; 
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
        height: 100%; 
        position: relative;
    }
    
    .template-card:hover { 
        border-color: var(--accent); 
        transform: scale(1.06) translateY(-8px); 
        box-shadow: var(--neon); 
        background: rgba(255, 255, 255, 0.08); 
    }
    
    .preview-box { 
        height: 140px; 
        background: #fff; 
        border-radius: 12px; 
        margin-bottom: 12px; 
        position: relative; 
        overflow: hidden; 
        padding: 12px; 
        display: flex; 
        flex-direction: column; 
        gap: 5px; 
        border: 1px solid rgba(0,0,0,0.1);
    }
    
    .badge-cat { 
        position: absolute; 
        top: 10px; 
        right: 10px; 
        font-size: 9px; 
        background: var(--accent); 
        color: black; 
        padding: 2px 8px; 
        border-radius: 20px; 
        font-weight: 900; 
    }
    
    .stat-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(255,255,255,0.05);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        border: 1px solid var(--border);
        backdrop-filter: blur(5px);
    }
    
    .stat-badge .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--success);
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    
    .section-control {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 25px;
        margin-bottom: 12px;
    }
    
    .section-control h6 {
        margin: 0;
        font-size: 0.85rem;
        font-weight: 700;
        letter-spacing: 0.5px;
    }
    
    .list-group-item {
        cursor: move;
        user-select: none;
        transition: all 0.2s;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .list-group-item:hover {
        background: rgba(255,255,255,0.05) !important;
        transform: translateX(5px);
    }
    
    .section-toggle {
        width: 20px;
        height: 20px;
        border-radius: 4px;
        border: 2px solid var(--accent);
        background: transparent;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
    }
    
    .section-toggle.active {
        background: var(--accent);
    }
    
    .section-toggle.active::after {
        content: '‚úì';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: black;
        font-size: 12px;
        font-weight: bold;
    }
    
    .section-toggle:hover {
        transform: scale(1.1);
        box-shadow: var(--neon);
    }
    
    .color-preset {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.3s;
    }
    
    .color-preset:hover {
        transform: scale(1.1);
        border-color: white;
    }
    
    .toast-notification {
        position: fixed;
        top: 100px;
        right: 20px;
        background: rgba(16, 185, 129, 0.95);
        color: white;
        padding: 15px 25px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        z-index: 6000;
        animation: slideIn 0.3s ease-out;
        display: none;
        backdrop-filter: blur(10px);
    }
    
    @keyframes slideIn {
        from { transform: translateX(400px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    .feature-panel {
        background: rgba(0,0,0,0.3);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 20px;
        margin-top: 20px;
    }
    
    .feature-toggle {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        background: rgba(255,255,255,0.03);
        border-radius: 10px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.3s;
        backdrop-filter: blur(5px);
        border: 1px solid transparent;
    }
    
    .feature-toggle:hover {
        background: rgba(255,255,255,0.08);
        border-color: rgba(255,255,255,0.1);
    }
    
    .toggle-switch {
        width: 40px;
        height: 22px;
        background: rgba(255,255,255,0.2);
        border-radius: 11px;
        position: relative;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .toggle-switch.active {
        background: var(--accent);
    }
    
    .toggle-switch::after {
        content: '';
        position: absolute;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: white;
        top: 2px;
        left: 2px;
        transition: all 0.3s;
    }
    
    .toggle-switch.active::after {
        left: 20px;
    }
    
    .template-option {
        padding: 8px 12px;
        background: rgba(255,255,255,0.05);
        border: 1px solid var(--border);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
        font-size: 0.8rem;
        backdrop-filter: blur(4px);
    }
    
    .template-option:hover {
        background: rgba(255,255,255,0.1);
        border-color: var(--accent);
    }
    
    .template-option.active {
        background: var(--accent);
        color: black;
        border-color: var(--accent);
        box-shadow: var(--neon);
    }
    
    .spacing-control {
        display: flex;
        gap: 5px;
        margin-top: 10px;
    }
    
    .spacing-btn {
        flex: 1;
        padding: 8px;
        background: rgba(255,255,255,0.05);
        border: 1px solid var(--border);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.75rem;
        backdrop-filter: blur(4px);
    }
    
    .spacing-btn:hover {
        background: rgba(255,255,255,0.1);
    }
    
    .spacing-btn.active {
        background: var(--accent);
        color: black;
        border-color: var(--accent);
        box-shadow: var(--neon);
    }
    
    .social-links-container {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        flex-wrap: wrap;
    }
    
    .social-link-input {
        display: flex;
        gap: 5px;
        align-items: center;
        margin-bottom: 8px;
    }
    
    .skill-tag {
        display: inline-block;
        padding: 4px 12px;
        background: var(--accent);
        color: white;
        border-radius: 15px;
        font-size: 0.8rem;
        margin: 3px;
        font-weight: 600;
    }
    
    .progress-bar-container {
        width: 100%;
        height: 8px;
        background: rgba(0,0,0,0.1);
        border-radius: 4px;
        overflow: hidden;
        margin-top: 5px;
    }
    
    .progress-bar-fill {
        height: 100%;
        background: var(--accent);
        transition: width 0.3s;
    }
    
    .qr-code-section {
        padding: 15px;
        background: rgba(255,255,255,0.05);
        border-radius: 12px;
        margin-top: 15px;
        text-align: center;
    }
    
    .quick-action-bar {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.6);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        padding: 15px 25px;
        border-radius: 50px;
        border: 1px solid rgba(255,255,255,0.1);
        display: flex;
        gap: 15px;
        z-index: 1000;
        box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    
    .quick-action-btn {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid transparent;
        color: white;
        cursor: pointer;
        font-size: 1.2rem;
        transition: all 0.3s;
        padding: 10px 14px;
        border-radius: 16px;
    }
    
    .quick-action-btn:hover {
        background: var(--accent);
        transform: scale(1.1) translateY(-5px);
        color: black;
        box-shadow: var(--neon);
    }
    
    .ai-assist-panel {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.1));
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 16px;
        padding: 20px;
        margin-top: 20px;
        backdrop-filter: blur(10px);
    }
    
    .keyword-chip {
        display: inline-block;
        padding: 6px 14px;
        background: rgba(139, 92, 246, 0.15);
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 20px;
        font-size: 0.75rem;
        margin: 3px;
        cursor: pointer;
        transition: all 0.3s;
        backdrop-filter: blur(4px);
    }
    
    .keyword-chip:hover {
        background: rgba(139, 92, 246, 0.4);
        transform: scale(1.05);
        border-color: rgba(139, 92, 246, 0.6);
    }
    
    .template-preview-modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        background: white;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        z-index: 6000;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        transition: all 0.3s;
    }
    
    .template-preview-modal.active {
        transform: translate(-50%, -50%) scale(1);
    }
    
    .language-skill-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding: 8px;
        background: rgba(255,255,255,0.03);
        border-radius: 8px;
    }
    
    .proficiency-dots {
        display: flex;
        gap: 5px;
    }
    
    .proficiency-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: rgba(255,255,255,0.2);
        transition: all 0.3s;
    }
    
    .proficiency-dot.active {
        background: var(--accent);
    }
    
    .zoom-controls {
        position: sticky;
        bottom: 20px;
        display: flex;
        gap: 8px;
        justify-content: center;
        margin-top: 20px;
        z-index: 100;
    }
    
    .zoom-btn {
        background: rgba(0,0,0,0.6);
        border: 1px solid rgba(255,255,255,0.2);
        color: white;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
        backdrop-filter: blur(4px);
    }
    
    .zoom-btn:hover {
        background: var(--accent);
        color: black;
        transform: scale(1.1);
        box-shadow: var(--neon);
    }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
    ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #7dd3fc; }
</style>
</head>
<body class="config-panel">

<div id="toast" class="toast-notification">
    <strong>‚úì Saved successfully!</strong>
</div>

<div id="gallery" class="gallery-overlay">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-5 sticky-top bg-dark py-4 px-3" style="top:-40px; border-radius: 0 0 30px 30px; border: 1px solid var(--border); border-top: none;">
            <h1 class="text-white m-0 fw-800">Design Vault <small class="text-info opacity-75 fs-6">100+ Pro Layouts</small></h1>
            <button class="btn btn-outline-light rounded-pill px-5 fw-bold" onclick="closeGallery()">Return to Editor</button>
        </div>
        <div id="gallery-grid" class="row g-4"></div>
    </div>
</div>

<nav class="navbar fixed-top bg-dark border-bottom border-secondary">
    <div class="container-fluid px-4">
        <span class="navbar-brand text-info fw-800 tracking-wider">‚ú® BOT CRAFT STUDIO</span>
        <div class="d-flex gap-2 align-items-center">
            <div class="stat-badge"><span class="dot"></span> Auto-Save On</div>
            <button class="btn glass-btn text-info px-4 fw-bold" onclick="openGallery()">CHOOSE DESIGN</button>
            <button class="btn glass-btn" onclick="exportJSON()" title="Export as JSON">üíæ Save</button>
            <button class="btn glass-btn" onclick="document.getElementById('importInput').click()" title="Import JSON">üìÇ Load</button>
            <input type="file" id="importInput" style="display:none" accept=".json" onchange="importJSON(event)">
            <button class="btn glass-btn" onclick="resetForm()" title="Clear all data">üóëÔ∏è Reset</button>
            <button class="btn glass-btn-primary px-4 fw-bold" onclick="exportPDF()">üìÑ Download PDF</button>
        </div>
    </div>
</nav>

<div class="container-fluid px-4">
    <div class="row g-4">
        <div class="col-lg-5" style="height: calc(100vh - 100px); overflow-y: auto; padding-bottom: 120px; padding-right: 15px;">
            <div class="glass-panel">
                <h6 class="text-info mb-3 fw-bold">üé® COLOR THEME</h6>
                <div class="row g-2 mb-3">
                    <div class="col-4"><label>Accent Color</label><input type="color" id="accentColor" class="form-control p-1" value="#38bdf8" oninput="updateAccent(this.value)"></div>
                    <div class="col-4"><label>Text Color</label><input type="color" id="fontColor" class="form-control p-1" value="#1e293b" oninput="liveUpdate()"></div>
                    <div class="col-4"><label>Background</label><input type="color" id="bgColor" class="form-control p-1" value="#ffffff" oninput="liveUpdate()"></div>
                </div>
                
                <div class="d-flex gap-2 mb-4">
                    <div class="color-preset" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" onclick="applyPreset('#667eea', '#1e293b', '#ffffff')" title="Purple Gradient"></div>
                    <div class="color-preset" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" onclick="applyPreset('#f5576c', '#1e293b', '#ffffff')" title="Pink Sunset"></div>
                    <div class="color-preset" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" onclick="applyPreset('#00f2fe', '#1e293b', '#ffffff')" title="Ocean Blue"></div>
                    <div class="color-preset" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);" onclick="applyPreset('#38f9d7', '#1e293b', '#ffffff')" title="Mint Fresh"></div>
                    <div class="color-preset" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" onclick="applyPreset('#fa709a', '#1e293b', '#ffffff')" title="Sunset"></div>
                </div>

                <div class="mt-4 p-4 bg-dark bg-opacity-40 rounded-4 border border-secondary mb-4 shadow-lg">
                    <h6 class="text-info mb-3 fw-bold small">üìù TYPOGRAPHY & SPACING</h6>
                    <div class="row g-3">
                        <div class="col-12">
                            <label>Font Family</label>
                            <select id="fontFamily" class="form-control glass-select" onchange="liveUpdate()">
                                <optgroup label="Modern Minimal">
                                    <option value="'Inter', sans-serif">Inter (Standard)</option>
                                    <option value="'Poppins', sans-serif">Poppins (Playful)</option>
                                    <option value="'Montserrat', sans-serif">Montserrat (Geometric)</option>
                                    <option value="'Open Sans', sans-serif">Open Sans (Friendly)</option>
                                </optgroup>
                                <optgroup label="Classic Academic">
                                    <option value="'Playfair Display', serif">Playfair (Elegant)</option>
                                    <option value="'Lora', serif">Lora (Sophisticated)</option>
                                </optgroup>
                                <optgroup label="Technical">
                                    <option value="'Fira Code', monospace">Fira Code (Developer)</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="col-6"><label>Title Size</label><input type="range" id="titleSize" class="form-range" min="1.5" max="4.5" step="0.1" value="2.5" oninput="liveUpdate()"><small class="text-white-50"><span id="titleSizeVal">2.5</span>rem</small></div>
                        <div class="col-6"><label>Body Size</label><input type="range" id="contentSize" class="form-range" min="0.6" max="1.2" step="0.05" value="0.9" oninput="liveUpdate()"><small class="text-white-50"><span id="contentSizeVal">0.9</span>rem</small></div>
                        <div class="col-6"><label>Line Height</label><input type="range" id="lineHeight" class="form-range" min="1" max="2.2" step="0.1" value="1.5" oninput="liveUpdate()"><small class="text-white-50"><span id="lineHeightVal">1.5</span></small></div>
                        <div class="col-6"><label>Letter Spacing</label><input type="range" id="letterSpacing" class="form-range" min="-1" max="3" step="0.2" value="0" oninput="liveUpdate()"><small class="text-white-50"><span id="letterSpacingVal">0</span>px</small></div>
                    </div>
                </div>

                <h6 class="text-info mb-3 fw-bold">üë§ PROFILE PHOTO</h6>
                <div class="row g-2 mb-4">
                    <div class="col-6"><label>Upload Image</label><input type="file" id="photo-input" class="form-control form-control-sm" accept="image/*" onchange="loadPhoto(event)"></div>
                    <div class="col-3 d-flex align-items-end"><button class="btn btn-sm btn-outline-danger w-100" onclick="removePhoto()">Remove</button></div>
                    <div class="col-3 d-flex align-items-end">
                        <select id="photoShape" class="form-control glass-select p-1" onchange="liveUpdate()">
                            <option value="50%">Circle</option>
                            <option value="12px">Rounded</option>
                            <option value="0">Square</option>
                        </select>
                    </div>
                </div>

                <h6 class="text-info mb-3 fw-bold">üìã BASIC INFO</h6>
                <div class="row g-2">
                    <div class="col-6"><label>First Name</label><input id="fn" class="form-control" placeholder="John" oninput="liveUpdate()"></div>
                    <div class="col-6"><label>Last Name</label><input id="ln" class="form-control" placeholder="Doe" oninput="liveUpdate()"></div>
                </div>
                <div class="row g-2 mt-2">
                    <div class="col-12">
                        <label>Email</label><input id="em" class="form-control mb-2" placeholder="john.doe@email.com" oninput="liveUpdate()">
                        <label>Phone</label><input id="ph" class="form-control mb-2" placeholder="+1 (555) 123-4567" oninput="liveUpdate()">
                        <label>Location</label><input id="lc" class="form-control" placeholder="New York, USA" oninput="liveUpdate()">
                    </div>
                </div>

                <div class="section-control"><h6 class="text-info">üíº PROFESSIONAL SUMMARY</h6></div>
                <div class="toolbar">
                    <button onclick="formatText('bold')" title="Bold">B</button>
                    <button onclick="formatText('italic')" title="Italic">I</button>
                    <button onclick="formatText('insertUnorderedList')" title="Bullet List">‚Ä¢</button>
                </div>
                <div id="sm" contenteditable="true" class="rich-editor" data-placeholder="Write a compelling summary about yourself..." oninput="liveUpdate()"></div>

                <div class="section-control"><h6 class="text-info">üíº EXPERIENCE</h6><button class="btn btn-sm glass-btn py-1 px-3" onclick="addExp()">+ Add</button></div>
                <div id="exp-container"></div>

                <div class="section-control"><h6 class="text-info">üöÄ PROJECTS</h6><button class="btn btn-sm glass-btn py-1 px-3" onclick="addProj()">+ Add</button></div>
                <div id="proj-container"></div>

                <div class="section-control"><h6 class="text-info">üéì EDUCATION</h6><button class="btn btn-sm glass-btn py-1 px-3" onclick="addEdu()">+ Add</button></div>
                <div id="edu-container"></div>

                <div class="section-control"><h6 class="text-info">üõ†Ô∏è SKILLS</h6></div>
                <div class="toolbar">
                    <button onclick="formatText('bold')">B</button>
                    <button onclick="formatText('insertUnorderedList')">‚Ä¢</button>
                </div>
                <div id="sk" contenteditable="true" class="rich-editor" data-placeholder="List your key skills..." oninput="liveUpdate()"></div>

                <div class="section-control"><h6 class="text-info">üìú CERTIFICATIONS</h6><button class="btn btn-sm glass-btn py-1 px-3" onclick="addCert()">+ Add</button></div>
                <div id="cert-container"></div>

                <div class="section-control"><h6 class="text-info">üìã ROLES & RESPONSIBILITIES</h6></div>
                <div class="toolbar">
                    <button onclick="formatText('bold')">B</button>
                    <button onclick="formatText('italic')">I</button>
                    <button onclick="formatText('insertUnorderedList')">‚Ä¢</button>
                </div>
                <div id="roles" contenteditable="true" class="rich-editor" data-placeholder="Describe your core responsibilities..." oninput="liveUpdate()"></div>

                <div class="section-control"><h6 class="text-info">üåç LANGUAGES</h6></div>
                <div class="toolbar"><button onclick="formatText('bold')">B</button></div>
                <div id="lang" contenteditable="true" class="rich-editor" data-placeholder="e.g., English (Native), Spanish (Fluent)" oninput="liveUpdate()"></div>

                <div class="section-control"><h6 class="text-info">üë• REFERENCES</h6><button class="btn btn-sm glass-btn py-1 px-3" onclick="addRef()">+ Add</button></div>
                <div id="ref-container"></div>

                <div class="section-control"><h6 class="text-warning">‚ûï CUSTOM SECTION</h6><button class="btn btn-sm glass-btn py-1 px-3" onclick="addCustom()">+ Add</button></div>
                <div id="custom-container"></div>

                <div class="mt-4 p-3 bg-dark rounded-4 border border-secondary shadow-sm">
                    <label class="mb-2">üîÑ SECTION ORDER (Drag to Reorder)</label>
                    <ul id="section-sort" class="list-group shadow-lg">
                        <li class="list-group-item bg-transparent text-white border-secondary py-2 small" data-id="summary">
                            <span>üìù Summary</span>
                            <div class="section-toggle active" onclick="toggleSection(this, 'summary')"></div>
                        </li>
                        <li class="list-group-item bg-transparent text-white border-secondary py-2 small" data-id="experience">
                            <span>üíº Experience</span>
                            <div class="section-toggle active" onclick="toggleSection(this, 'experience')"></div>
                        </li>
                        <li class="list-group-item bg-transparent text-white border-secondary py-2 small" data-id="education">
                            <span>üéì Education</span>
                            <div class="section-toggle active" onclick="toggleSection(this, 'education')"></div>
                        </li>
                        <li class="list-group-item bg-transparent text-white border-secondary py-2 small" data-id="projects">
                            <span>üöÄ Projects</span>
                            <div class="section-toggle active" onclick="toggleSection(this, 'projects')"></div>
                        </li>
                        <li class="list-group-item bg-transparent text-white border-secondary py-2 small" data-id="roles">
                            <span>üìã Roles & Responsibilities</span>
                            <div class="section-toggle active" onclick="toggleSection(this, 'roles')"></div>
                        </li>
                        <li class="list-group-item bg-transparent text-white border-secondary py-2 small" data-id="skills">
                            <span>üõ†Ô∏è Skills</span>
                            <div class="section-toggle active" onclick="toggleSection(this, 'skills')"></div>
                        </li>
                        <li class="list-group-item bg-transparent text-white border-secondary py-2 small" data-id="certifications">
                            <span>üìú Certifications</span>
                            <div class="section-toggle active" onclick="toggleSection(this, 'certifications')"></div>
                        </li>
                        <li class="list-group-item bg-transparent text-white border-secondary py-2 small" data-id="languages">
                            <span>üåç Languages</span>
                            <div class="section-toggle active" onclick="toggleSection(this, 'languages')"></div>
                        </li>
                        <li class="list-group-item bg-transparent text-white border-secondary py-2 small" data-id="references">
                            <span>üë• References</span>
                            <div class="section-toggle active" onclick="toggleSection(this, 'references')"></div>
                        </li>
                    </ul>
                    <small class="text-white-50 d-block mt-2">üí° Tip: Click checkboxes to hide/show sections</small>
                </div>

                <div class="feature-panel">
                    <h6 class="text-info mb-3 fw-bold small">‚öôÔ∏è ADVANCED FEATURES</h6>
                    
                    <div class="feature-toggle" onclick="toggleFeature('showPhoto')">
                        <div class="toggle-switch active" id="toggle-showPhoto"></div>
                        <span>Show Profile Photo</span>
                    </div>
                    
                    <div class="feature-toggle" onclick="toggleFeature('showContactIcons')">
                        <div class="toggle-switch" id="toggle-showContactIcons"></div>
                        <span>Contact Icons</span>
                    </div>
                    
                    <div class="feature-toggle" onclick="toggleFeature('boldHeadings')">
                        <div class="toggle-switch active" id="toggle-boldHeadings"></div>
                        <span>Bold Section Headers</span>
                    </div>
                    
                    <div class="feature-toggle" onclick="toggleFeature('showBorders')">
                        <div class="toggle-switch active" id="toggle-showBorders"></div>
                        <span>Section Dividers</span>
                    </div>
                    
                    <label class="mt-3 mb-2">Layout Style</label>
                    <div class="row g-2">
                        <div class="col-4"><div class="template-option active" id="layout-single" onclick="setLayout('single')">Single</div></div>
                        <div class="col-4"><div class="template-option" id="layout-two" onclick="setLayout('two')">Two Col</div></div>
                        <div class="col-4"><div class="template-option" id="layout-sidebar" onclick="setLayout('sidebar')">Sidebar</div></div>
                    </div>
                    
                    <label class="mt-3 mb-2">Section Spacing</label>
                    <div class="spacing-control">
                        <div class="spacing-btn" onclick="setSpacing('compact')">Compact</div>
                        <div class="spacing-btn active" onclick="setSpacing('normal')">Normal</div>
                        <div class="spacing-btn" onclick="setSpacing('spacious')">Spacious</div>
                    </div>
                    
                    <label class="mt-3 mb-2">Date Format</label>
                    <select id="dateFormat" class="form-control glass-select" onchange="liveUpdate()">
                        <option value="month-year">Month Year (Jan 2020)</option>
                        <option value="year">Year Only (2020)</option>
                        <option value="full">Full Date (January 2020)</option>
                    </select>
                    
                    <label class="mt-3 mb-2">Header Alignment</label>
                    <div class="row g-2">
                        <div class="col-4"><div class="template-option" id="align-left" onclick="setAlignment('left')">Left</div></div>
                        <div class="col-4"><div class="template-option active" id="align-center" onclick="setAlignment('center')">Center</div></div>
                        <div class="col-4"><div class="template-option" id="align-right" onclick="setAlignment('right')">Right</div></div>
                    </div>
                </div>

                <div class="ai-assist-panel">
                    <h6 class="text-purple mb-3 fw-bold small">ü§ñ AI SUGGESTIONS</h6>
                    <label class="mb-2">Industry Keywords</label>
                    <div id="keyword-suggestions" class="mb-3">
                        <span class="keyword-chip" onclick="insertKeyword('Leadership')">Leadership</span>
                        <span class="keyword-chip" onclick="insertKeyword('Data Analysis')">Data Analysis</span>
                        <span class="keyword-chip" onclick="insertKeyword('Project Management')">Project Management</span>
                        <span class="keyword-chip" onclick="insertKeyword('Agile Methodology')">Agile Methodology</span>
                        <span class="keyword-chip" onclick="insertKeyword('Cross-functional Collaboration')">Cross-functional</span>
                        <span class="keyword-chip" onclick="insertKeyword('Strategic Planning')">Strategic Planning</span>
                    </div>
                    
                    <div class="feature-toggle" onclick="toggleFeature('showSkillBars')">
                        <div class="toggle-switch" id="toggle-showSkillBars"></div>
                        <span>Show Skill Progress Bars</span>
                    </div>
                    
                    <div class="feature-toggle" onclick="toggleFeature('compactMode')">
                        <div class="toggle-switch" id="toggle-compactMode"></div>
                        <span>Ultra-Compact Mode (ATS Friendly)</span>
                    </div>
                    
                    <div class="feature-toggle" onclick="toggleFeature('showPageNumbers')">
                        <div class="toggle-switch" id="toggle-showPageNumbers"></div>
                        <span>Page Numbers</span>
                    </div>
                </div>

                <div class="feature-panel">
                    <h6 class="text-info mb-3 fw-bold small">üîó SOCIAL LINKS</h6>
                    <div id="social-container">
                        <div class="social-link-input">
                            <select class="form-control glass-select p-1" style="width: 120px;" id="social-type-0">
                                <option value="linkedin">LinkedIn</option>
                                <option value="github">GitHub</option>
                                <option value="portfolio">Portfolio</option>
                                <option value="twitter">Twitter</option>
                                <option value="website">Website</option>
                            </select>
                            <input type="url" class="form-control" id="social-url-0" placeholder="https://..." oninput="liveUpdate()">
                        </div>
                    </div>
                    <button class="btn btn-sm glass-btn w-100 mt-2" onclick="addSocialLink()">+ Add Social Link</button>
                </div>

                <div class="feature-panel">
                    <h6 class="text-info mb-3 fw-bold small">üìä LANGUAGE PROFICIENCY</h6>
                    <div id="language-proficiency-container"></div>
                    <button class="btn btn-sm glass-btn w-100 mt-2" onclick="addLanguageProficiency()">+ Add Language</button>
                    
                    <div class="feature-toggle mt-3" onclick="toggleFeature('showProficiencyBars')">
                        <div class="toggle-switch active" id="toggle-showProficiencyBars"></div>
                        <span>Show Proficiency Levels</span>
                    </div>
                </div>

                <div class="feature-panel">
                    <h6 class="text-warning mb-3 fw-bold small">‚ö° QUICK ACTIONS</h6>
                    <button class="btn btn-sm glass-btn w-100 mb-2" onclick="duplicateResume()">üìã Duplicate Resume</button>
                    <button class="btn btn-sm glass-btn w-100 mb-2" onclick="exportHTML()">üåê Export as HTML</button>
                    <button class="btn btn-sm glass-btn w-100 mb-2" onclick="printResume()">üñ®Ô∏è Print Resume</button>
                    <button class="btn btn-sm glass-btn w-100 mb-2" onclick="shareResume()">üì§ Share Link</button>
                    <button class="btn btn-sm glass-btn w-100" onclick="showStatistics()">üìà Resume Statistics</button>
                </div>

                <div class="feature-panel">
                    <h6 class="text-success mb-3 fw-bold small">üé® THEME PRESETS</h6>
                    <div class="row g-2">
                        <div class="col-6"><button class="btn btn-sm glass-btn w-100" onclick="applyTheme('professional')">Professional</button></div>
                        <div class="col-6"><button class="btn btn-sm glass-btn w-100" onclick="applyTheme('creative')">Creative</button></div>
                        <div class="col-6"><button class="btn btn-sm glass-btn w-100" onclick="applyTheme('minimal')">Minimal</button></div>
                        <div class="col-6"><button class="btn btn-sm glass-btn w-100" onclick="applyTheme('modern')">Modern</button></div>
                        <div class="col-6"><button class="btn btn-sm glass-btn w-100" onclick="applyTheme('academic')">Academic</button></div>
                        <div class="col-6"><button class="btn btn-sm glass-btn w-100" onclick="applyTheme('tech')">Tech</button></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-7">
            <div id="resume-wrapper" style="height: calc(100vh - 100px); overflow-y: auto; padding: 20px;">
                <div id="resume-target" class="resume-preview mx-auto"></div>
                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="zoomOut()" title="Zoom Out">‚àí</button>
                    <button class="zoom-btn" onclick="resetZoom()" title="Reset Zoom">‚ü≤</button>
                    <button class="zoom-btn" onclick="zoomIn()" title="Zoom In">+</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="quick-action-bar">
    <button class="quick-action-btn" onclick="exportPDF()" title="Download PDF">üìÑ</button>
    <button class="quick-action-btn" onclick="exportJSON()" title="Save">üíæ</button>
    <button class="quick-action-btn" onclick="printResume()" title="Print">üñ®Ô∏è</button>
    <button class="quick-action-btn" onclick="openGallery()" title="Change Design">üé®</button>
    <button class="quick-action-btn" onclick="showStatistics()" title="Statistics">üìä</button>
</div>

<div id="stats-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 7000; align-items: center; justify-content: center;">
    <div class="glass-panel" style="max-width: 500px; margin: 20px;">
        <h3 class="text-info mb-4">üìä Resume Statistics</h3>
        <div id="stats-content"></div>
        <button class="btn glass-btn w-100 mt-4" onclick="document.getElementById('stats-modal').style.display='none'">Close</button>
    </div>
</div>

<script>
    let currentStyle = 'apollo';
    let photoData = "";
    let currentZoom = 1;
    let autoSaveTimer = null;
    let hiddenSections = new Set();
    let socialLinks = [];
    let languageProficiency = [];
    let features = {
        showPhoto: true,
        showContactIcons: false,
        boldHeadings: true,
        showBorders: true,
        showSkillBars: false,
        compactMode: false,
        showPageNumbers: false,
        showProficiencyBars: true
    };
    let layoutStyle = 'single';
    let sectionSpacing = 'normal';
    let headerAlignment = 'center';
    let socialLinkCount = 1;
    
    const sortable = Sortable.create(document.getElementById('section-sort'), { 
        animation: 150,
        handle: '.list-group-item',
        onEnd: () => {
            liveUpdate();
            showToast('Section order updated');
        }
    });
    
    function showToast(message) {
        const toast = document.getElementById('toast');
        toast.innerHTML = `<strong>‚úì ${message}</strong>`;
        toast.style.display = 'block';
        setTimeout(() => { toast.style.display = 'none'; }, 2000);
    }
    
    function loadPhoto(e) { 
        const f = e.target.files[0]; 
        if (f) { 
            if (f.size > 5000000) {
                alert('Image too large! Please use an image under 5MB.');
                return;
            }
            const r = new FileReader(); 
            r.onload = (re) => { 
                photoData = re.target.result; 
                liveUpdate();
                showToast('Photo uploaded');
            }; 
            r.readAsDataURL(f); 
        } 
    }
    
    function removePhoto() { 
        photoData = ""; 
        document.getElementById('photo-input').value = ""; 
        liveUpdate();
        showToast('Photo removed');
    }

    function applyPreset(accent, font, bg) {
        document.getElementById('accentColor').value = accent;
        document.getElementById('fontColor').value = font;
        document.getElementById('bgColor').value = bg;
        updateAccent(accent);
        showToast('Color preset applied');
    }
    
    function toggleSection(element, sectionId) {
        element.classList.toggle('active');
        if (hiddenSections.has(sectionId)) {
            hiddenSections.delete(sectionId);
        } else {
            hiddenSections.add(sectionId);
        }
        liveUpdate();
        showToast(`Section ${hiddenSections.has(sectionId) ? 'hidden' : 'shown'}`);
    }
    
    function toggleFeature(featureName) {
        features[featureName] = !features[featureName];
        const toggle = document.getElementById(`toggle-${featureName}`);
        if (toggle) {
            toggle.classList.toggle('active');
        }
        liveUpdate();
        showToast(`${featureName} ${features[featureName] ? 'enabled' : 'disabled'}`);
    }
    
    function setLayout(layout) {
        layoutStyle = layout;
        document.querySelectorAll('.template-option[id^="layout-"]').forEach(el => el.classList.remove('active'));
        document.getElementById(`layout-${layout}`).classList.add('active');
        liveUpdate();
        showToast(`${layout} layout applied`);
    }
    
    function setSpacing(spacing) {
        sectionSpacing = spacing;
        document.querySelectorAll('.spacing-btn').forEach(el => el.classList.remove('active'));
        event.target.classList.add('active');
        liveUpdate();
        showToast(`${spacing} spacing applied`);
    }
    
    function setAlignment(align) {
        headerAlignment = align;
        document.querySelectorAll('.template-option[id^="align-"]').forEach(el => el.classList.remove('active'));
        document.getElementById(`align-${align}`).classList.add('active');
        liveUpdate();
        showToast(`${align} alignment applied`);
    }
    
    function formatDate(dateStr) {
        if (!dateStr) return '';
        const format = document.getElementById('dateFormat').value;
        const date = new Date(dateStr + '-01');
        const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        const monthsShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        
        switch(format) {
            case 'year':
                return date.getFullYear().toString();
            case 'full':
                return `${months[date.getMonth()]} ${date.getFullYear()}`;
            default:
                return `${monthsShort[date.getMonth()]} ${date.getFullYear()}`;
        }
    }
    
    function addSocialLink(data = null) {
        const container = document.getElementById('social-container');
        const count = socialLinkCount; 
        const selectedType = data ? data.type : 'linkedin';
        const urlValue = data ? data.url : '';
        
        container.insertAdjacentHTML('beforeend', `
            <div class="social-link-input">
                <select class="form-control glass-select p-1" style="width: 120px;" id="social-type-${count}">
                    <option value="linkedin" ${selectedType === 'linkedin' ? 'selected' : ''}>LinkedIn</option>
                    <option value="github" ${selectedType === 'github' ? 'selected' : ''}>GitHub</option>
                    <option value="portfolio" ${selectedType === 'portfolio' ? 'selected' : ''}>Portfolio</option>
                    <option value="twitter" ${selectedType === 'twitter' ? 'selected' : ''}>Twitter</option>
                    <option value="website" ${selectedType === 'website' ? 'selected' : ''}>Website</option>
                </select>
                <input type="url" class="form-control" id="social-url-${count}" placeholder="https://..." oninput="liveUpdate()" value="${urlValue}">
                <button class="btn btn-sm btn-outline-danger" onclick="this.parentElement.remove(); liveUpdate()">√ó</button>
            </div>
        `);
        socialLinkCount++;
        if(!data) liveUpdate();
    }
    
    function addLanguageProficiency(data = null) {
        const container = document.getElementById('language-proficiency-container');
        const id = Date.now();
        const langValue = data ? data.language : '';
        const level = data ? data.level : 3;

        container.insertAdjacentHTML('beforeend', `
            <div class="language-skill-row" id="lang-prof-${id}">
                <input type="text" class="form-control" placeholder="Language" style="flex: 1; margin-right: 10px;" oninput="liveUpdate()" value="${langValue}">
                <div class="proficiency-dots">
                    <div class="proficiency-dot ${level >= 1 ? 'active' : ''}" onclick="setProficiency(this, 1)"></div>
                    <div class="proficiency-dot ${level >= 2 ? 'active' : ''}" onclick="setProficiency(this, 2)"></div>
                    <div class="proficiency-dot ${level >= 3 ? 'active' : ''}" onclick="setProficiency(this, 3)"></div>
                    <div class="proficiency-dot ${level >= 4 ? 'active' : ''}" onclick="setProficiency(this, 4)"></div>
                    <div class="proficiency-dot ${level >= 5 ? 'active' : ''}" onclick="setProficiency(this, 5)"></div>
                </div>
                <button class="btn btn-sm btn-link text-danger" onclick="removeEl('lang-prof-${id}')">√ó</button>
            </div>
        `);
        if(!data) liveUpdate();
    }
    
    function setProficiency(element, level) {
        const dots = element.parentElement.querySelectorAll('.proficiency-dot');
        dots.forEach((dot, index) => {
            if (index < level) {
                dot.classList.add('active');
            } else {
                dot.classList.remove('active');
            }
        });
        liveUpdate();
    }
    
    function insertKeyword(keyword) {
        const summary = document.getElementById('sm');
        if (summary.innerText.trim() === '') {
            summary.innerHTML = `<p>${keyword}</p>`;
        } else {
            summary.innerHTML += ` ${keyword}`;
        }
        liveUpdate();
        showToast(`Added keyword: ${keyword}`);
    }
    
    function duplicateResume() {
        const data = collectData();
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `resume_copy_${Date.now()}.json`;
        a.click();
        showToast('Resume duplicated!');
    }
    
    function exportHTML() {
        const resumeContent = document.getElementById('resume-target').outerHTML;
        const htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume - ${document.getElementById('fn').value} ${document.getElementById('ln').value}</title>
    <style>
        body { font-family: ${document.getElementById('fontFamily').value}; margin: 0; padding: 20px; }
        .resume-preview { max-width: 794px; margin: 0 auto; }
        .sec-item { page-break-inside: avoid; }
    </style>
</head>
<body>
    ${resumeContent}
</body>
</html>`;
        
        const blob = new Blob([htmlContent], {type: 'text/html'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `resume_${document.getElementById('fn').value}_${document.getElementById('ln').value}.html`;
        a.click();
        showToast('HTML exported!');
    }
    
    function printResume() {
        const printWindow = window.open('', '', 'width=800,height=600');
        const content = document.getElementById('resume-target').innerHTML;
        printWindow.document.write(`
            <html>
                <head>
                    <title>Print Resume</title>
                    <style>
                        body { font-family: ${document.getElementById('fontFamily').value}; }
                        .sec-item { break-inside: avoid; page-break-inside: avoid; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>${content}</body>
            </html>
        `);
        printWindow.document.close();
        printWindow.print();
    }
    
    function shareResume() {
        const data = collectData();
        const jsonStr = JSON.stringify(data);
        const encoded = btoa(jsonStr);
        const shareUrl = `${window.location.href}?resume=${encoded}`;
        
        if (navigator.clipboard) {
            navigator.clipboard.writeText(shareUrl).then(() => {
                showToast('Share link copied to clipboard!');
            });
        } else {
            prompt('Copy this link to share your resume:', shareUrl);
        }
    }
    
    function showStatistics() {
        const content = document.getElementById('resume-target').innerText;
        const words = content.trim().split(/\s+/).length;
        const chars = content.length;
        const sections = document.querySelectorAll('.sec-item').length;
        const experiences = document.querySelectorAll('#exp-container .entry-card').length;
        const projects = document.querySelectorAll('#proj-container .entry-card').length;
        const education = document.querySelectorAll('#edu-container .entry-card').length;
        
        const statsHTML = `
            <div class="row g-3">
                <div class="col-6 text-center">
                    <h2 class="text-info">${words}</h2>
                    <small class="text-white-50">Total Words</small>
                </div>
                <div class="col-6 text-center">
                    <h2 class="text-info">${chars}</h2>
                    <small class="text-white-50">Characters</small>
                </div>
                <div class="col-6 text-center">
                    <h2 class="text-info">${sections}</h2>
                    <small class="text-white-50">Sections</small>
                </div>
                <div class="col-6 text-center">
                    <h2 class="text-info">${experiences}</h2>
                    <small class="text-white-50">Experiences</small>
                </div>
                <div class="col-6 text-center">
                    <h2 class="text-info">${projects}</h2>
                    <small class="text-white-50">Projects</small>
                </div>
                <div class="col-6 text-center">
                    <h2 class="text-info">${education}</h2>
                    <small class="text-white-50">Education</small>
                </div>
            </div>
            <div class="mt-4 p-3 bg-dark rounded">
                <strong class="text-success">‚úì Resume Quality: ${words > 300 ? 'Excellent' : words > 150 ? 'Good' : 'Needs More Content'}</strong>
                <p class="text-white-50 mb-0 mt-2 small">Ideal resume length: 300-800 words</p>
            </div>
        `;
        
        document.getElementById('stats-content').innerHTML = statsHTML;
        document.getElementById('stats-modal').style.display = 'flex';
    }
    
    function applyTheme(themeName) {
        const themes = {
            professional: { accent: '#2563eb', font: '#1e293b', bg: '#ffffff', fontFam: "'Inter', sans-serif" },
            creative: { accent: '#ec4899', font: '#1e293b', bg: '#fef3c7', fontFam: "'Poppins', sans-serif" },
            minimal: { accent: '#000000', font: '#000000', bg: '#ffffff', fontFam: "'Inter', sans-serif" },
            modern: { accent: '#8b5cf6', font: '#1e293b', bg: '#ffffff', fontFam: "'Montserrat', sans-serif" },
            academic: { accent: '#064e3b', font: '#1e293b', bg: '#ffffff', fontFam: "'Playfair Display', serif" },
            tech: { accent: '#0891b2', font: '#1e293b', bg: '#f0f9ff', fontFam: "'Fira Code', monospace" }
        };
        
        const theme = themes[themeName];
        if (theme) {
            document.getElementById('accentColor').value = theme.accent;
            document.getElementById('fontColor').value = theme.font;
            document.getElementById('bgColor').value = theme.bg;
            document.getElementById('fontFamily').value = theme.fontFam;
            updateAccent(theme.accent);
            showToast(`${themeName} theme applied!`);
        }
    }

    function zoomIn() {
        currentZoom = Math.min(currentZoom + 0.1, 2);
        applyZoom();
    }
    
    function zoomOut() {
        currentZoom = Math.max(currentZoom - 0.1, 0.5);
        applyZoom();
    }
    
    function resetZoom() {
        currentZoom = 1;
        applyZoom();
    }
    
    function applyZoom() {
        document.getElementById('resume-target').style.transform = `scale(${currentZoom})`;
        document.getElementById('resume-target').style.transformOrigin = 'top center';
    }

    function openGallery() {
        const grid = document.getElementById('gallery-grid');
        const categories = { 
            'Professional': ['Apollo', 'Executive', 'Classic', 'Clean'], 
            'Modern': ['Modern', 'Aura', 'Midnight', 'Elegant'], 
            'Tech': ['Tech', 'Startup', 'Grid', 'Fira'], 
            'Minimalist': ['Minimal', 'Timeline', 'Mono', 'Base'] 
        };
        const userName = (document.getElementById('fn').value || 'User') + ' ' + (document.getElementById('ln').value || 'Name');
        let html = '';
        
        Object.entries(categories).forEach(([cat, items]) => {
            html += `<div class="col-12 mt-4"><h4 class="text-white border-start border-info ps-3" style="font-weight: 800;">${cat} Designs</h4></div>`;
            for(let i=1; i<=25; i++) {
                const type = items[i % items.length].toLowerCase();
                const accent = `hsl(${(i * 15 + Object.keys(categories).indexOf(cat)*90) % 360}, 65%, 60%)`;
                html += `<div class="col-6 col-md-3 col-lg-2">
                    <div class="template-card" onclick="currentStyle='${type}'; liveUpdate(); closeGallery(); showToast('Design applied')">
                        <span class="badge-cat">${cat.toUpperCase()}</span>
                        <div class="preview-box" style="border-top: 4px solid ${accent}">
                            <div style="font-size:8px; font-weight:800; border-bottom:1px solid ${accent}; display:inline-block">${userName}</div>
                            <div style="height:2px; background:#e2e8f0; width:100%; margin-top:5px;"></div>
                            <div style="height:10px; background:${accent}11; margin-top:auto; width:100%;"></div>
                        </div>
                        <div class="text-center text-white mt-1" style="font-size: 11px; font-weight: 600;">${items[i % items.length]} v${i}</div>
                    </div>
                </div>`;
            }
        });
        
        grid.innerHTML = html;
        document.getElementById('gallery').style.display = 'block';
    }

    function closeGallery() { 
        document.getElementById('gallery').style.display = 'none'; 
    }
    
    function updateAccent(val) { 
        document.documentElement.style.setProperty('--accent', val); 
        document.documentElement.style.setProperty('--neon', `0 0 15px ${val}99`); 
        liveUpdate(); 
    }
    
    function formatText(cmd) { 
        document.execCommand(cmd, false, null); 
        liveUpdate(); 
    }
    
    function removeEl(id) { 
        if (confirm('Delete this entry?')) {
            document.getElementById(id).remove(); 
            liveUpdate(); 
            showToast('Entry deleted');
        }
    }
    
    function toggleCard(btn) {
        const card = btn.closest('.entry-card');
        card.classList.toggle('collapsed');
        btn.innerText = card.classList.contains('collapsed') ? '+' : '‚àí';
    }
    
    function updateCardTitle(input, selector, fallback) {
        const card = input.closest('.entry-card');
        const titleEl = card.querySelector('.card-title-preview');
        titleEl.innerText = input.value || fallback;
        liveUpdate();
    }

    function addExp(data = null) {
        const id = Date.now();
        const comp = data ? data.company : '';
        const role = data ? data.role : '';
        const loc = data ? data.location : '';
        const start = data ? data.start : '';
        const end = data ? data.end : '';
        const desc = data ? data.desc : '';

        document.getElementById('exp-container').insertAdjacentHTML('beforeend', `
            <div class="entry-card" id="exp-${id}">
                <div class="entry-header">
                    <h6 class="card-title-preview">${comp || 'New Experience'}</h6>
                    <button class="btn btn-sm btn-outline-light" onclick="toggleCard(this)" title="Minimize/Maximize">‚àí<button>
                </div>
                <div class="entry-body">
                    <label>Company</label><input class="form-control mb-2 fw-bold exp-co" placeholder="Company Name" oninput="updateCardTitle(this, '.exp-co', 'New Experience')" value="${comp}">
                    <label>Role</label><input class="form-control mb-2 exp-ro" placeholder="Job Title" oninput="liveUpdate()" value="${role}">
                    <label>Location</label><input class="form-control mb-2 exp-lo" placeholder="City, Country" oninput="liveUpdate()" value="${loc}">
                    <div class="row g-2">
                        <div class="col-6"><label>Start Date</label><input type="month" class="form-control sd" oninput="liveUpdate()" value="${start}"></div>
                        <div class="col-6"><label>End Date</label><input type="month" class="form-control ed" oninput="liveUpdate()" value="${end}"></div>
                    </div>
                    <label class="mt-2">Description</label>
                    <div class="toolbar">
                        <button onclick="formatText('bold')">B</button>
                        <button onclick="formatText('italic')">I</button>
                        <button onclick="formatText('insertUnorderedList')">‚Ä¢</button>
                    </div>
                    <div contenteditable="true" class="rich-editor" data-placeholder="Describe your achievements..." oninput="liveUpdate()">${desc}</div>
                    <button class="btn btn-sm btn-outline-danger w-100 mt-2" onclick="removeEl('exp-${id}')">Delete Entry</button>
                </div>
            </div>`);
        if(!data) showToast('Experience entry added');
    }

    function addProj(data = null) {
        const id = Date.now();
        const title = data ? data.title : '';
        const role = data ? data.role : '';
        const desc = data ? data.desc : '';

        document.getElementById('proj-container').insertAdjacentHTML('beforeend', `
            <div class="entry-card" id="prj-${id}">
                <div class="entry-header">
                    <h6 class="card-title-preview">${title || 'New Project'}</h6>
                    <button class="btn btn-sm btn-outline-light" onclick="toggleCard(this)">‚àí</button>
                </div>
                <div class="entry-body">
                    <label>Project Title</label><input class="form-control mb-2 fw-bold prj-ti" placeholder="Project Name" oninput="updateCardTitle(this, '.prj-ti', 'New Project')" value="${title}">
                    <label>Your Role</label><input class="form-control mb-2 prj-ro" placeholder="Your Role" oninput="liveUpdate()" value="${role}">
                    <label>Description</label>
                    <div class="toolbar">
                        <button onclick="formatText('bold')">B</button>
                        <button onclick="formatText('insertUnorderedList')">‚Ä¢</button>
                    </div>
                    <div contenteditable="true" class="rich-editor" data-placeholder="Describe the project..." oninput="liveUpdate()">${desc}</div>
                    <button class="btn btn-sm btn-outline-danger w-100 mt-2" onclick="removeEl('prj-${id}')">Delete</button>
                </div>
            </div>`);
        if(!data) showToast('Project added');
    }

    function addEdu(data = null) {
        const id = Date.now();
        const school = data ? data.school : '';
        const degree = data ? data.degree : '';
        const start = data ? data.start : '';
        const end = data ? data.end : '';

        document.getElementById('edu-container').insertAdjacentHTML('beforeend', `
            <div class="entry-card" id="edu-${id}">
                <div class="entry-header">
                    <h6 class="card-title-preview">${school || 'New Education'}</h6>
                    <button class="btn btn-sm btn-outline-light" onclick="toggleCard(this)">‚àí</button>
                </div>
                <div class="entry-body">
                    <label>School/University</label><input class="form-control mb-2 fw-bold edu-sc" placeholder="Institution Name" oninput="updateCardTitle(this, '.edu-sc', 'New Education')" value="${school}">
                    <label>Degree</label><input class="form-control mb-2 edu-dg" placeholder="Degree/Certificate" oninput="liveUpdate()" value="${degree}">
                    <div class="row g-2">
                        <div class="col-6"><label>Start</label><input type="month" class="form-control sd" oninput="liveUpdate()" value="${start}"></div>
                        <div class="col-6"><label>End</label><input type="month" class="form-control ed" oninput="liveUpdate()" value="${end}"></div>
                    </div>
                    <button class="btn btn-sm btn-outline-danger w-100 mt-2" onclick="removeEl('edu-${id}')">Delete</button>
                </div>
            </div>`);
        if(!data) showToast('Education entry added');
    }

    function addCert(data = null) {
        const id = Date.now();
        const name = data ? data.name : '';
        const prov = data ? data.provider : '';
        const date = data ? data.date : '';

        document.getElementById('cert-container').insertAdjacentHTML('beforeend', `
            <div class="entry-card" id="cert-${id}">
                <div class="entry-header">
                    <h6 class="card-title-preview">${name || 'New Certification'}</h6>
                    <button class="btn btn-sm btn-outline-light" onclick="toggleCard(this)">‚àí</button>
                </div>
                <div class="entry-body">
                    <label>Certification Name</label><input class="form-control mb-2 fw-bold c-na" placeholder="Certification Title" oninput="updateCardTitle(this, '.c-na', 'New Certification')" value="${name}">
                    <label>Provider</label><input class="form-control mb-2 c-pr" placeholder="Issuing Organization" oninput="liveUpdate()" value="${prov}">
                    <label>Issue Date</label><input type="month" class="form-control c-ex" oninput="liveUpdate()" value="${date}">
                    <button class="btn btn-sm btn-outline-danger w-100 mt-2" onclick="removeEl('cert-${id}')">Delete</button>
                </div>
            </div>`);
        if(!data) showToast('Certification added');
    }

    function addRef(data = null) {
        const id = Date.now();
        const name = data ? data.name : '';
        const title = data ? data.title : '';

        document.getElementById('ref-container').insertAdjacentHTML('beforeend', `
            <div class="entry-card" id="ref-${id}">
                <label>Reference Name</label><input class="form-control mb-2 fw-bold ref-na" placeholder="Full Name" oninput="liveUpdate()" value="${name}">
                <label>Title/Position</label><input class="form-control mb-2 ref-ti" placeholder="Job Title" oninput="liveUpdate()" value="${title}">
                <button class="btn btn-sm btn-outline-danger w-100 mt-2" onclick="removeEl('ref-${id}')">Delete</button>
            </div>`);
        if(!data) showToast('Reference added');
    }

    function addCustom(data = null) {
        const id = Date.now();
        const title = data ? data.title : '';
        const content = data ? data.content : '';

        document.getElementById('custom-container').insertAdjacentHTML('beforeend', `
            <div class="entry-card" id="cust-${id}">
                <div class="entry-header">
                    <h6 class="card-title-preview">${title || 'New Section'}</h6>
                    <button class="btn btn-sm btn-outline-light" onclick="toggleCard(this)">‚àí</button>
                </div>
                <div class="entry-body">
                    <label>Section Title</label><input class="form-control mb-2 fw-bold cust-ti" placeholder="Custom Section Name" oninput="updateSortList('${id}', this.value); updateCardTitle(this, '.cust-ti', 'New Section')" value="${title}">
                    <label>Content</label>
                    <div class="toolbar">
                        <button onclick="formatText('bold')">B</button>
                        <button onclick="formatText('italic')">I</button>
                        <button onclick="formatText('insertUnorderedList')">‚Ä¢</button>
                    </div>
                    <div contenteditable="true" class="rich-editor" data-placeholder="Add custom content..." oninput="liveUpdate()">${content}</div>
                    <button class="btn btn-sm btn-outline-danger w-100 mt-2" onclick="removeEl('cust-${id}')">Delete</button>
                </div>
            </div>`);
        
        // Only add sort list item if it doesn't exist (prevents duplicates on reload)
        if(!document.getElementById(`li-cust-${id}`)) {
            document.getElementById('section-sort').insertAdjacentHTML('beforeend', 
                `<li class="list-group-item bg-transparent text-info border-info py-2 small" data-id="cust-${id}" id="li-cust-${id}">
                    <span>${title || '‚ûï New Section'}</span>
                    <div class="section-toggle active" onclick="toggleSection(this, 'cust-${id}')"></div>
                </li>`);
        }
        if(!data) showToast('Custom section added');
    }
    
    function updateSortList(id, val) { 
        const li = document.getElementById('li-cust-'+id); 
        if(li) {
            const span = li.querySelector('span');
            if (span) span.innerText = val || "‚ûï New Section";
        }
    }

    function getSections(fCol, cSize) {
        const order = Array.from(document.querySelectorAll('#section-sort li')).map(li => li.dataset.id);
        const spacingMap = { compact: '10px', normal: '25px', spacious: '40px' };
        const sectionMargin = features.compactMode ? '10px' : (spacingMap[sectionSpacing] || '25px');
        
        const borderStyle = features.showBorders ? `border-bottom:2px solid var(--accent);` : `border-bottom:none;`;
        const headingWeight = features.boldHeadings ? '800' : '600';
        const hStyle = `color:var(--accent); ${borderStyle} padding-bottom:5px; margin-bottom:15px; font-size:${features.compactMode ? '0.85rem' : '0.95rem'}; font-weight:${headingWeight};`;
        
        let html = '';
        
        order.forEach(id => {
            if (hiddenSections.has(id)) return;
            
            const hasC = (elId) => { 
                let el = document.getElementById(elId); 
                return el && el.innerText.trim().length > 0; 
            };
            
            if (id === 'summary' && hasC('sm')) {
                html += `<div class="sec-item" style="margin-bottom:${sectionMargin}"><div class="section-header" style="${hStyle}">Professional Summary</div><div style="font-size:${cSize}rem; line-height:${features.compactMode ? '1.4' : '1.6'}">${document.getElementById('sm').innerHTML}</div></div>`;
            }
            
            if (id === 'experience') {
                const items = Array.from(document.querySelectorAll('#exp-container .entry-card')).filter(e => e.querySelector('.exp-co').value);
                if (items.length) {
                    html += `<div class="sec-item" style="margin-bottom:${sectionMargin}"><div class="section-header" style="${hStyle}">Professional Experience</div>`;
                    items.forEach(el => {
                        const start = formatDate(el.querySelector('.sd').value);
                        const end = el.querySelector('.ed').value ? formatDate(el.querySelector('.ed').value) : 'Present';
                        html += `<div class="mb-${features.compactMode ? '2' : '4'}" style="font-size:${cSize}rem; break-inside: avoid; page-break-inside: avoid;">
                            <div style="display:flex; justify-content:space-between; align-items:baseline; flex-wrap:wrap;">
                                <strong style="font-size:1.1em">${el.querySelector('.exp-ro').value}</strong>
                                <span style="opacity:0.6; font-size:0.9em">${start} ‚Äî ${end}</span>
                            </div>
                            <div style="color:var(--accent); font-weight:600; margin:3px 0">${el.querySelector('.exp-co').value}</div>
                            <div style="opacity:0.7; font-size:0.9em; margin-bottom:8px">${el.querySelector('.exp-lo').value}</div>
                            <div style="line-height:${features.compactMode ? '1.4' : '1.6'}">${el.querySelector('.rich-editor').innerHTML}</div>
                        </div>`;
                    });
                    html += `</div>`;
                }
            }
            
            if (id === 'education') {
                const items = Array.from(document.querySelectorAll('#edu-container .entry-card')).filter(e => e.querySelector('.edu-sc').value);
                if (items.length) {
                    html += `<div class="sec-item" style="margin-bottom:${sectionMargin}"><div class="section-header" style="${hStyle}">Education</div>`;
                    items.forEach(el => {
                        const start = formatDate(el.querySelector('.sd').value);
                        const end = formatDate(el.querySelector('.ed').value);
                        html += `<div class="mb-3" style="font-size:${cSize}rem; break-inside: avoid; page-break-inside: avoid;">
                            <div style="display:flex; justify-content:space-between; flex-wrap:wrap;">
                                <strong style="font-size:1.05em">${el.querySelector('.edu-sc').value}</strong>
                                <span style="opacity:0.6; font-size:0.9em">${start} ‚Äî ${end}</span>
                            </div>
                            <div style="color:var(--accent); margin-top:3px">${el.querySelector('.edu-dg').value}</div>
                        </div>`;
                    });
                    html += `</div>`;
                }
            }
            
            if (id === 'projects') {
                const items = Array.from(document.querySelectorAll('#proj-container .entry-card')).filter(e => e.querySelector('.prj-ti').value);
                if (items.length) {
                    html += `<div class="sec-item" style="margin-bottom:${sectionMargin}"><div class="section-header" style="${hStyle}">Projects</div>`;
                    items.forEach(el => {
                        html += `<div class="mb-3" style="font-size:${cSize}rem; break-inside: avoid; page-break-inside: avoid;">
                            <strong style="font-size:1.05em">${el.querySelector('.prj-ti').value}</strong> 
                            <span style="opacity:0.7; font-style:italic">(${el.querySelector('.prj-ro').value})</span>
                            <div style="margin-top:6px; line-height:${features.compactMode ? '1.4' : '1.6'}">${el.querySelector('.rich-editor').innerHTML}</div>
                        </div>`;
                    });
                    html += `</div>`;
                }
            }
            
            if (id === 'skills' && hasC('sk')) {
                let skillsContent = document.getElementById('sk').innerHTML;
                if (features.showSkillBars) {
                    const skillItems = document.getElementById('sk').innerText.split('\n').filter(s => s.trim());
                    skillsContent = skillItems.map(skill => `
                        <div style="margin-bottom: 8px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="font-size: 0.9em;">${skill}</span>
                            </div>
                            <div style="width: 100%; height: 6px; background: rgba(0,0,0,0.1); border-radius: 3px; overflow: hidden;">
                                <div style="width: ${Math.random() * 30 + 70}%; height: 100%; background: var(--accent);"></div>
                            </div>
                        </div>
                    `).join('');
                }
                html += `<div class="sec-item" style="margin-bottom:${sectionMargin}"><div class="section-header" style="${hStyle}">Skills & Expertise</div><div style="font-size:${cSize}rem; line-height:${features.compactMode ? '1.4' : '1.6'}">${skillsContent}</div></div>`;
            }
            
            if (id === 'certifications') {
                const items = Array.from(document.querySelectorAll('#cert-container .entry-card')).filter(e => e.querySelector('.c-na').value);
                if (items.length) {
                    html += `<div class="sec-item" style="margin-bottom:${sectionMargin}"><div class="section-header" style="${hStyle}">Certifications</div>`;
                    items.forEach(el => {
                        const issued = formatDate(el.querySelector('.c-ex').value);
                        html += `<div class="mb-2" style="font-size:${cSize}rem; break-inside: avoid;">
                            <strong>${el.querySelector('.c-na').value}</strong> - ${el.querySelector('.c-pr').value} 
                            <span style="float:right; opacity:0.6; font-size:0.9em">${issued}</span>
                        </div>`;
                    });
                    html += `</div>`;
                }
            }
            
            if (id === 'roles' && hasC('roles')) {
                html += `<div class="sec-item" style="margin-bottom:${sectionMargin}"><div class="section-header" style="${hStyle}">Core Responsibilities</div><div style="font-size:${cSize}rem; line-height:${features.compactMode ? '1.4' : '1.6'}">${document.getElementById('roles').innerHTML}</div></div>`;
            }
            
            if (id === 'languages' && hasC('lang')) {
                let langContent = document.getElementById('lang').innerHTML;
                
                const proficiencyItems = document.querySelectorAll('#language-proficiency-container .language-skill-row');
                if (proficiencyItems.length > 0 && features.showProficiencyBars) {
                    langContent = '<div>';
                    proficiencyItems.forEach(item => {
                        const langName = item.querySelector('input').value;
                        const activeDots = item.querySelectorAll('.proficiency-dot.active').length;
                        const percentage = (activeDots / 5) * 100;
                        if (langName) {
                            langContent += `
                                <div style="margin-bottom: 10px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                        <span>${langName}</span>
                                        <span style="font-size: 0.85em; opacity: 0.7;">${['Beginner', 'Elementary', 'Intermediate', 'Advanced', 'Native'][activeDots-1]}</span>
                                    </div>
                                    <div style="width: 100%; height: 6px; background: rgba(0,0,0,0.1); border-radius: 3px;">
                                        <div style="width: ${percentage}%; height: 100%; background: var(--accent);"></div>
                                    </div>
                                </div>
                            `;
                        }
                    });
                    langContent += '</div>';
                } else if (!hasC('lang') && proficiencyItems.length === 0) {
                    return;
                }
                
                html += `<div class="sec-item" style="margin-bottom:${sectionMargin}"><div class="section-header" style="${hStyle}">Languages</div><div style="font-size:${cSize}rem">${langContent}</div></div>`;
            }
            
            if (id === 'references') {
                const items = Array.from(document.querySelectorAll('#ref-container .entry-card')).filter(e => e.querySelector('.ref-na').value);
                if (items.length) {
                    html += `<div class="sec-item" style="margin-bottom:${sectionMargin}"><div class="section-header" style="${hStyle}">References</div>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; font-size:${cSize}rem">`;
                    items.forEach(el => {
                        html += `<div style="break-inside: avoid;">
                            <strong>${el.querySelector('.ref-na').value}</strong><br>
                            <small style="opacity:0.7">${el.querySelector('.ref-ti').value}</small>
                        </div>`;
                    });
                    html += `</div></div>`;
                }
            }
            
            if (id.startsWith('cust-')) {
                const el = document.getElementById(id);
                if(el && el.querySelector('.cust-ti').value) {
                    html += `<div class="sec-item" style="margin-bottom:${sectionMargin}"><div class="section-header" style="${hStyle}">${el.querySelector('.cust-ti').value}</div><div style="font-size:${cSize}rem; line-height:${features.compactMode ? '1.4' : '1.6'}">${el.querySelector('.rich-editor').innerHTML}</div></div>`;
                }
            }
        });
        
        return html;
    }
    
    function liveUpdate() {
        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(autoSave, 3000);
        
        const target = document.getElementById('resume-target');
        const fCol = document.getElementById('fontColor').value;
        const fFam = document.getElementById('fontFamily').value;
        const tSize = document.getElementById('titleSize').value;
        const cSize = document.getElementById('contentSize').value;
        const lH = document.getElementById('lineHeight').value;
        const lS = document.getElementById('letterSpacing').value;
        const pRadius = document.getElementById('photoShape').value;
        
        document.getElementById('titleSizeVal').textContent = tSize;
        document.getElementById('contentSizeVal').textContent = cSize;
        document.getElementById('lineHeightVal').textContent = lH;
        document.getElementById('letterSpacingVal').textContent = lS;

        target.style.backgroundColor = document.getElementById('bgColor').value;
        target.style.color = fCol;
        target.style.fontFamily = fFam;
        target.style.lineHeight = lH;
        target.style.letterSpacing = lS + 'px';
        
        const photo = (photoData && features.showPhoto) ? `<img src="${photoData}" style="width:120px; height:120px; border-radius:${pRadius}; border:3px solid var(--accent); margin-bottom:15px; object-fit:cover; box-shadow: 0 10px 30px rgba(0,0,0,0.15);">` : '';
        const firstName = document.getElementById('fn').value || 'FIRST';
        const lastName = document.getElementById('ln').value || 'LAST';
        const nameText = `${firstName} ${lastName}`;
        const email = document.getElementById('em').value;
        const phone = document.getElementById('ph').value;
        const location = document.getElementById('lc').value;
        
        const contactIcon = features.showContactIcons ? 'üìß ' : '';
        const phoneIcon = features.showContactIcons ? 'üì± ' : '';
        const locationIcon = features.showContactIcons ? 'üìç ' : '';
        
        const contactParts = [];
        if (email) contactParts.push(`${contactIcon}${email}`);
        if (phone) contactParts.push(`${phoneIcon}${phone}`);
        if (location) contactParts.push(`${locationIcon}${location}`);
        const contactInfo = contactParts.join(' ‚Ä¢ ');
        
        const socialLinksHTML = [];
        document.querySelectorAll('[id^="social-type-"]').forEach((select, index) => {
            const container = select.closest('.social-link-input');
            const urlInput = container.querySelector('input');
            if (urlInput && urlInput.value) {
                const type = select.value;
                const url = urlInput.value;
                const icons = { linkedin: 'üíº', github: 'üíª', portfolio: 'üåê', twitter: 'üê¶', website: 'üîó' };
                socialLinksHTML.push(`<a href="${url}" style="color: var(--accent); text-decoration: none; margin: 0 8px;">${icons[type] || 'üîó'} ${type}</a>`);
            }
        });
        
        const textAlign = headerAlignment;
        
        const header = `<div style="margin-bottom:${features.compactMode ? '20px' : '40px'}; text-align:${textAlign};">
            ${photo}
            <h1 style="margin:0; font-weight:900; font-size:${tSize}rem; color:${fCol}; letter-spacing:-1px; line-height:1.1;">${nameText}</h1>
            ${contactInfo ? `<div style="opacity:0.75; font-size:${parseFloat(cSize)*0.95}rem; font-weight:500; margin-top:10px;">${contactInfo}</div>` : ''}
            ${socialLinksHTML.length ? `<div style="margin-top: 10px;">${socialLinksHTML.join('')}</div>` : ''}
        </div>`;
        
        const sections = getSections(fCol, cSize);
        
        let pageNumberHTML = '';
        if (features.showPageNumbers) {
            pageNumberHTML = `<div style="position: absolute; bottom: 20px; right: 20px; opacity: 0.5; font-size: 0.8rem;">Page 1</div>`;
        }
        
        if (layoutStyle === 'sidebar') {
            target.innerHTML = `<div style="display:grid; grid-template-columns: 280px 1fr; gap: 40px;"><div style="border-right:2px solid rgba(0,0,0,0.1); padding-right:25px">${header}</div><div>${sections}</div></div>${pageNumberHTML}`;
        } else if (layoutStyle === 'two') {
            target.innerHTML = `${header}<div style="display:grid; grid-template-columns: 1fr 1fr; gap: 30px;">${sections}</div>${pageNumberHTML}`;
        } else if(['modern','aura','midnight'].includes(currentStyle)) {
            target.innerHTML = `<div style="background:${fCol}; color:white; margin:-50px -50px 45px -50px; padding:60px 50px; display:flex; gap:40px; align-items:center; box-shadow: 0 10px 30px rgba(0,0,0,0.15);">${photo}<div style="flex:1;"><h1 style="margin:0; font-weight:900; font-size:${tSize}rem; color:white; line-height:1.1">${nameText}</h1>${contactInfo ? `<div style="opacity:0.9; font-size:${parseFloat(cSize)*0.95}rem; margin-top:8px">${contactInfo.replace(contactIcon, '').replace(phoneIcon, '').replace(locationIcon, '')}</div>` : ''}</div></div>${sections}${pageNumberHTML}`;
        } else {
            target.innerHTML = header + sections + pageNumberHTML;
        }
        
        document.querySelectorAll('.page-break-guide').forEach(g => g.remove());
        for(let i=1; i < Math.ceil(target.scrollHeight / 1123); i++) {
            target.insertAdjacentHTML('beforeend', `<div class="page-break-guide" style="top: ${i * 1123}px"></div>`);
        }
    }
    
    function autoSave() {
        try {
            const data = collectData();
            localStorage.setItem('resumeAutoSave', JSON.stringify(data));
        } catch(e) {
            console.log('Auto-save failed:', e);
        }
    }
    
    function loadAutoSave() {
        try {
            const saved = localStorage.getItem('resumeAutoSave');
            if (saved && confirm('Found auto-saved data. Would you like to restore it?')) {
                restoreData(JSON.parse(saved));
                showToast('Auto-save restored');
            }
        } catch(e) {
            console.log('Auto-load failed:', e);
        }
    }
    
    function collectData() {
        // Collect Lists
        const experiences = Array.from(document.querySelectorAll('#exp-container .entry-card')).map(card => ({
            company: card.querySelector('.exp-co').value,
            role: card.querySelector('.exp-ro').value,
            location: card.querySelector('.exp-lo').value,
            start: card.querySelector('.sd').value,
            end: card.querySelector('.ed').value,
            desc: card.querySelector('.rich-editor').innerHTML
        }));

        const projects = Array.from(document.querySelectorAll('#proj-container .entry-card')).map(card => ({
            title: card.querySelector('.prj-ti').value,
            role: card.querySelector('.prj-ro').value,
            desc: card.querySelector('.rich-editor').innerHTML
        }));

        const education = Array.from(document.querySelectorAll('#edu-container .entry-card')).map(card => ({
            school: card.querySelector('.edu-sc').value,
            degree: card.querySelector('.edu-dg').value,
            start: card.querySelector('.sd').value,
            end: card.querySelector('.ed').value
        }));

        const certifications = Array.from(document.querySelectorAll('#cert-container .entry-card')).map(card => ({
            name: card.querySelector('.c-na').value,
            provider: card.querySelector('.c-pr').value,
            date: card.querySelector('.c-ex').value
        }));

        const references = Array.from(document.querySelectorAll('#ref-container .entry-card')).map(card => ({
            name: card.querySelector('.ref-na').value,
            title: card.querySelector('.ref-ti').value
        }));

        const customSections = Array.from(document.querySelectorAll('#custom-container .entry-card')).map(card => ({
            title: card.querySelector('.cust-ti').value,
            content: card.querySelector('.rich-editor').innerHTML
        }));
        
        const socialLinksData = Array.from(document.querySelectorAll('.social-link-input')).map(el => ({
            type: el.querySelector('select').value,
            url: el.querySelector('input').value
        })).filter(s => s.url);

        const langProficiencyData = Array.from(document.querySelectorAll('.language-skill-row')).map(el => ({
            language: el.querySelector('input').value,
            level: el.querySelectorAll('.proficiency-dot.active').length
        })).filter(l => l.language);

        return {
            fn: document.getElementById('fn').value,
            ln: document.getElementById('ln').value,
            em: document.getElementById('em').value,
            ph: document.getElementById('ph').value,
            lc: document.getElementById('lc').value,
            sm: document.getElementById('sm').innerHTML,
            sk: document.getElementById('sk').innerHTML,
            roles: document.getElementById('roles').innerHTML,
            lang: document.getElementById('lang').innerHTML,
            accent: document.getElementById('accentColor').value,
            fontCol: document.getElementById('fontColor').value,
            bgCol: document.getElementById('bgColor').value,
            fontFam: document.getElementById('fontFamily').value,
            titleSize: document.getElementById('titleSize').value,
            contentSize: document.getElementById('contentSize').value,
            lineHeight: document.getElementById('lineHeight').value,
            letterSpacing: document.getElementById('letterSpacing').value,
            photoShape: document.getElementById('photoShape').value,
            dateFormat: document.getElementById('dateFormat').value,
            style: currentStyle,
            photo: photoData,
            hiddenSections: Array.from(hiddenSections),
            features: features,
            layoutStyle: layoutStyle,
            sectionSpacing: sectionSpacing,
            headerAlignment: headerAlignment,
            // Enhanced Lists
            experiences: experiences,
            projects: projects,
            education: education,
            certifications: certifications,
            references: references,
            customSections: customSections,
            socialLinks: socialLinksData,
            langProficiency: langProficiencyData,
            timestamp: new Date().toISOString()
        };
    }
    
    function restoreData(data) {
        document.getElementById('fn').value = data.fn || '';
        document.getElementById('ln').value = data.ln || '';
        document.getElementById('em').value = data.em || '';
        document.getElementById('ph').value = data.ph || '';
        document.getElementById('lc').value = data.lc || '';
        document.getElementById('sm').innerHTML = data.sm || '';
        document.getElementById('sk').innerHTML = data.sk || '';
        document.getElementById('roles').innerHTML = data.roles || '';
        document.getElementById('lang').innerHTML = data.lang || '';
        document.getElementById('accentColor').value = data.accent || '#38bdf8';
        document.getElementById('fontColor').value = data.fontCol || '#1e293b';
        document.getElementById('bgColor').value = data.bgCol || '#ffffff';
        document.getElementById('fontFamily').value = data.fontFam || "'Inter', sans-serif";
        document.getElementById('titleSize').value = data.titleSize || '2.5';
        document.getElementById('contentSize').value = data.contentSize || '0.9';
        document.getElementById('lineHeight').value = data.lineHeight || '1.5';
        document.getElementById('letterSpacing').value = data.letterSpacing || '0';
        document.getElementById('photoShape').value = data.photoShape || '50%';
        document.getElementById('dateFormat').value = data.dateFormat || 'month-year';
        photoData = data.photo || '';
        currentStyle = data.style || 'apollo';
        
        // Restore Dynamic Lists
        document.getElementById('exp-container').innerHTML = '';
        if(data.experiences) data.experiences.forEach(item => addExp(item));
        else addExp(); // Add empty if none

        document.getElementById('proj-container').innerHTML = '';
        if(data.projects) data.projects.forEach(item => addProj(item));

        document.getElementById('edu-container').innerHTML = '';
        if(data.education) data.education.forEach(item => addEdu(item));

        document.getElementById('cert-container').innerHTML = '';
        if(data.certifications) data.certifications.forEach(item => addCert(item));

        document.getElementById('ref-container').innerHTML = '';
        if(data.references) data.references.forEach(item => addRef(item));

        document.getElementById('custom-container').innerHTML = '';
        // Clear old custom sorts to avoid dupes
        document.querySelectorAll('[id^="li-cust-"]').forEach(el => el.remove());
        if(data.customSections) data.customSections.forEach(item => addCustom(item));
        
        document.getElementById('social-container').innerHTML = '';
        if(data.socialLinks && data.socialLinks.length > 0) {
            data.socialLinks.forEach(item => addSocialLink(item));
        } else {
            addSocialLink(); // Default empty
        }

        document.getElementById('language-proficiency-container').innerHTML = '';
        if(data.langProficiency) data.langProficiency.forEach(item => addLanguageProficiency(item));
        
        if (data.hiddenSections) {
            hiddenSections = new Set(data.hiddenSections);
            data.hiddenSections.forEach(sectionId => {
                const li = document.querySelector(`li[data-id="${sectionId}"]`);
                if (li) {
                    const toggle = li.querySelector('.section-toggle');
                    if (toggle) toggle.classList.remove('active');
                }
            });
        }
        
        if (data.features) {
            features = { ...features, ...data.features };
            Object.keys(features).forEach(key => {
                const toggle = document.getElementById(`toggle-${key}`);
                if (toggle) {
                    if (features[key]) {
                        toggle.classList.add('active');
                    } else {
                        toggle.classList.remove('active');
                    }
                }
            });
        }
        
        if (data.layoutStyle) {
            layoutStyle = data.layoutStyle;
            document.querySelectorAll('.template-option[id^="layout-"]').forEach(el => el.classList.remove('active'));
            const layoutEl = document.getElementById(`layout-${data.layoutStyle}`);
            if (layoutEl) layoutEl.classList.add('active');
        }
        
        if (data.sectionSpacing) {
            sectionSpacing = data.sectionSpacing;
        }
        
        if (data.headerAlignment) {
            headerAlignment = data.headerAlignment;
            document.querySelectorAll('.template-option[id^="align-"]').forEach(el => el.classList.remove('active'));
            const alignEl = document.getElementById(`align-${data.headerAlignment}`);
            if (alignEl) alignEl.classList.add('active');
        }
        
        updateAccent(data.accent || '#38bdf8');
    }
    
    function exportPDF() { 
        showToast('Generating PDF...');
        document.querySelectorAll('.page-break-guide').forEach(g => g.style.display = 'none');
        const originalZoom = currentZoom;
        currentZoom = 1;
        applyZoom();
        
        html2pdf().set({ 
            margin: 0, 
            filename: `resume_${document.getElementById('fn').value}_${document.getElementById('ln').value}.pdf`.replace(/\s+/g, '_'), 
            html2canvas: { scale: 2.2, useCORS: true }, 
            jsPDF: { unit: 'px', format: [794, 1123], orientation: 'portrait' }, 
            pagebreak: { mode: ['css', 'legacy'] } 
        }).from(document.getElementById('resume-target')).save().then(() => {
            document.querySelectorAll('.page-break-guide').forEach(g => g.style.display = 'block');
            currentZoom = originalZoom;
            applyZoom();
            showToast('PDF downloaded successfully!');
        });
    }
    
    function exportJSON() { 
        const data = collectData();
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const a = document.createElement('a'); 
        a.href = URL.createObjectURL(blob); 
        a.download = `resume_${data.fn}_${data.ln}_${Date.now()}.json`.replace(/\s+/g, '_'); 
        a.click();
        showToast('Resume saved as JSON!');
    }
    
    function importJSON(e) { 
        const f = e.target.files[0]; 
        if(!f) return; 
        const r = new FileReader(); 
        r.onload = (re) => { 
            try {
                const data = JSON.parse(re.target.result);
                restoreData(data);
                liveUpdate();
                showToast('Resume loaded successfully!');
            } catch(err) {
                alert('Invalid file format. Please select a valid resume JSON file.');
            }
        }; 
        r.readAsText(f); 
    }
    
    function resetForm() { 
        if(confirm("This will delete all your data. Are you sure?")) {
            localStorage.removeItem('resumeAutoSave');
            location.reload();
        }
    }
    
    window.onload = () => { 
        addExp();
        liveUpdate();
        loadAutoSave();
    };
</script>
</body>
</html>
